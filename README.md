# AI驱动的代码生成系统

一个基于多智能体协作的AI代码生成系统，能够根据用户需求自动生成完整的项目代码，包括计划制定、代码生成和质量评估。

## 核心功能

- **智能项目规划**：自动分析用户需求，生成结构化的项目计划
- **高质量代码生成**：使用先进的LLM模型生成完整、可运行的代码文件
- **代码质量评估**：对生成的代码进行全面评估，确保质量和一致性
- **依赖自动管理**：根据生成的代码自动生成requirements.txt
- **跨文件一致性检查**：确保生成的文件之间引用关系正确
- **命令行接口**：提供友好的命令行交互界面

## 核心智能体

### 1. Planner（项目规划智能体）

**特征**：
- 分析用户需求，生成结构化的项目计划
- 支持web搜索增强，获取最新技术信息
- 生成详细的任务列表和文件结构
- 为每个文件分配明确的角色（data/view/logic/style/entry_point）

**运用方法**：
- 接收用户的项目需求描述
- 分析需求，确定项目类型和所需文件
- 生成包含任务列表和文件结构的JSON格式计划
- 支持web搜索获取相关技术文档和最佳实践

**工作流程**：
1. 接收用户需求
2. 提取关键词，进行web搜索（可选）
3. 生成结构化的项目计划
4. 返回包含任务列表和文件结构的JSON格式输出

### 2. CodeGen（代码生成智能体）

**特征**：
- 根据Planner生成的计划，逐个生成代码文件
- 支持代码知识库，提高代码质量和一致性
- 支持web搜索工具，获取最新的代码模板和示例
- 确保生成的代码符合项目结构和文件引用规范
- 生成完整、可运行的代码文件

**代码知识库**：
- 包含常见代码模式和最佳实践
- 提供代码质量和一致性检查
- 确保生成的代码符合行业标准
- 支持多种编程语言和框架

**运用方法**：
- 接收Planner生成的计划和文件信息
- 生成符合要求的代码文件
- 使用代码知识库确保代码质量和一致性
- 必要时使用web搜索获取相关代码模板和示例
- 确保生成的代码可运行且符合项目结构

**工作流程**：
1. 接收文件生成任务
2. 分析文件需求和相关信息
3. 使用代码知识库和web搜索（可选）
4. 生成完整的代码文件
5. 保存到指定输出目录

### 3. Evaluator（代码评估智能体）

**特征**：
- 对生成的代码进行全面评估
- 检查代码的可执行性、质量和一致性
- 支持Python文件的特殊处理
- 提供详细的评估报告和质量评分
- 支持根据评估结果调整代码质量

**运用方法**：
- 对生成的每个文件进行评估
- 检查代码的可执行性（仅Python文件）
- 检查代码质量和一致性
- 检查跨文件引用关系
- 生成详细的评估报告和质量评分

**评估指标**：
- **modularity**：代码模块化程度
- **maintainability**：代码可维护性
- **functional_completeness**：功能完整性
- **requirements_adherence**：需求符合度

**工作流程**：
1. 接收生成的代码文件
2. 分析代码内容和结构
3. 检查可执行性（仅Python文件）
4. 生成详细的评估报告
5. 根据评估结果调整质量评分

## 完整工作流程

1. **用户输入**：用户提供项目需求描述
2. **规划阶段**：
   - Planner分析需求，生成项目计划
   - 生成任务列表和文件结构
3. **代码生成阶段**：
   - 按照计划逐个生成代码文件
   - 使用CodeGen智能体和代码知识库
   - 生成每个文件后立即进行评估
4. **评估阶段**：
   - Evaluator对每个文件进行评估
   - 检查依赖和跨文件一致性
   - 根据评估结果调整代码质量
5. **生成requirements.txt**：
   - 根据生成的代码自动生成依赖列表
   - 只包含实际使用的第三方依赖
6. **输出结果**：
   - 生成完整的项目代码
   - 输出到指定目录
   - 显示生成的文件列表

## 安装和配置

### 安装依赖

```bash
pip install -r requirements.txt
```

### 配置API密钥

在项目根目录创建`.env`文件，添加您的DASHSCOPE API密钥：

```
DASHSCOPE_API_KEY=your_api_key_here
```

## 使用方法

### 命令行接口

项目提供了友好的命令行接口，您可以直接使用`codegen-cli.py`进行代码生成。

#### 直接提供项目要求

```bash
python codegen-cli.py "创建一个简单的待办事项应用"
```

#### 交互式输入

```bash
python codegen-cli.py
```

#### 指定输出目录

```bash
python codegen-cli.py "创建一个简单的待办事项应用" -o ./my-todo-app
```

#### 使用特定模型

```bash
python codegen-cli.py "创建一个简单的待办事项应用" -m qwen3-coder-plus
```

#### 查看帮助

```bash
python codegen-cli.py -h
```

## 示例：论文网站生成

### 生成论文网站

```bash
python codegen-cli.py "创建一个arXiv CS Daily论文网站，具有以下功能：
1. 显示每日计算机科学论文
2. 支持按类别筛选
3. 支持搜索功能
4. 响应式设计，适配移动端和桌面端" -o ./output
```

### 生成的文件结构

生成的论文网站将包含以下文件：

```
output/
  ├── index.html          # 主页面
  ├── detail.html         # 论文详情页面
  ├── data/
  │   └── papers.json     # 论文数据
  ├── static/
  │   ├── css/
  │   │   └── style.css   # 样式文件
  │   └── js/
  │       └── app.js      # JavaScript逻辑
  └── requirements.txt     # 依赖列表
```

### 本地服务器访问

生成论文网站后，您可以使用Python内置的HTTP服务器访问该网站：

```bash
cd ./output
python -m http.server 8000
```

然后在浏览器中访问：

```
http://localhost:8000
```

## 核心文件说明

### orchestrator.py

多智能体协作编排器，实现任务调度、通信管理和状态管理的核心功能。负责协调Planner、CodeGen和Evaluator智能体的工作流程。

### codegen-cli.py

命令行接口，提供用户友好的交互界面，支持直接输入项目要求、交互式输入、指定输出目录和使用特定模型。

### llm_client.py

LLM客户端，负责与DashScope API通信，处理模型调用和响应解析。

### agents/planner.py

项目规划智能体，负责分析用户需求，生成结构化的项目计划和文件列表。

### agents/codegen.py

代码生成智能体，负责根据计划生成具体的代码文件，支持代码知识库和工具调用。

### agents/evaluator.py

代码评估智能体，负责对生成的代码进行评估，检查依赖和跨文件一致性。

### tools/

包含各种工具，如文件系统工具、web搜索工具、代码执行工具和代码知识库。

## 工作流程图

```
用户需求 → Planner → 项目计划 → CodeGen → 代码生成 → Evaluator → 评估报告
                                 ↑               ↑
                                 |               |
                                 └── 代码知识库 ─┘
```

## 质量控制

- **TARGET_QUALITY_SCORE**：默认0.7，低于该分数的文件将被标记为需要修复
- **MAX_FIX_ATTEMPTS**：默认5，每个文件最多尝试修复5次
- **自动修复机制**：评估分数低于目标分数的文件将自动尝试修复
- **requirements.txt生成**：根据生成的代码自动生成依赖列表

## 跨文件一致性检查

- **HTML/JS/CSS/JSON文件检查**：确保文件之间的引用关系正确
- **Python文件检查**：确保Python文件的可执行性和质量
- **依赖关系检查**：确保文件之间的依赖关系正确
- **命名一致性检查**：确保文件和变量命名一致

## 技术栈

- **Python**：项目主要开发语言
- **DashScope API**：LLM模型调用
- **asyncio**：异步编程支持
- **argparse**：命令行接口支持
- **re**：正则表达式支持
- **json**：JSON处理
- **dotenv**：环境变量管理

## 扩展和定制

### 添加新的智能体

您可以通过继承现有的智能体类，添加新的智能体或扩展现有智能体的功能。

### 定制智能体行为

您可以修改智能体的系统提示（如CODEGEN_SYSTEM_PROMPT）来定制智能体的行为。

### 添加新的工具

您可以在tools目录下添加新的工具，扩展系统的功能。

## 故障排除

### 常见错误

1. **API密钥错误**：确保.env文件中包含正确的DASHSCOPE_API_KEY
2. **模型调用错误**：检查网络连接和API密钥
3. **代码生成错误**：检查项目需求描述是否清晰
4. **评估失败**：可能是代码质量问题，尝试重新生成或修改需求

### 日志和调试

系统会生成详细的日志信息，您可以根据日志信息进行调试和故障排除。

## 贡献

欢迎提交问题和拉取请求，帮助改进项目。


---

感谢使用AI驱动的代码生成系统！
